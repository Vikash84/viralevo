
Bootstrap: yum
OSVersion: 6
MirrorURL: http://mirror.centos.org/centos-6/6/os/x86_64/
Include: yum

%post
### basic setup of system wide tools and dependencies
apt-get install -y yum
yum update -y
yum install -y wget
yum install -y epel-release
yum install -y R
yum install -y \
    make \
    gcc \
    gcc-c++ \
    libcurl-devel \
    libxml2-devel \
    java-1.7.0-openjdk-devel \
    openssl-devel \
    texlive-* \
    pandoc \
    python-pip

##### ANACONDA INSTALLATION #####
mkdir -p /opt/software/anaconda
cd /opt/software/anaconda
wget -O Anaconda2-2019.10-Linux-x86_64.sh "https://repo.anaconda.com/archive/Anaconda2-2019.10-Linux-x86_64.sh"
bash Anaconda2-2019.10-Linux-x86_64.sh -b -f -p /opt/software/anaconda
eval "$(/opt/software/anaconda/bin/conda shell.bash hook)"
conda init

#### INSTALL remaining PACKAGES WITH CONDA #####
wget -O environment.yml "https://raw.githubusercontent.com/nibscbioinformatics/viralevo/master/environment.yml"
conda env create -f environment.yml
#

### R packages installations
mkdir -p /opt/software/rpackages
cd /opt/software/rpackages
Rscript -e "install.packages('BiocManager', repos = 'https://cloud.r-project.org')"
Rscript -e "BiocManager::install('ggtree')"

%environment
export PATH=/opt/software/anaconda/envs/nibscbioinformatics-viralevo-1.0dev/bin:${PATH}
